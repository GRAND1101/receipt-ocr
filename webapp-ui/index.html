<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>소비 분석 웹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- ✅ 추가 CSS -->
    <style>
      .hidden { display: none; }
      .w-64 { width: 16rem; /* 128px */ }
      .object-contain { object-fit: contain; }
    </style>
  </head>

  <body class="bg-gray-100 text-gray-900">
    <div class="flex min-h-screen">
      <!-- ✅ 사이드바 -->
      <aside class="w-64 bg-white shadow-lg">
        <div class="p-4 text-xl font-bold border-b">나의 소비 분석</div>
        <div id="auth-buttons" class="p-4">
          <a href="/login" id="loginBtn" class="bg-green-500 text-white px-4 py-2 rounded">Google 로그인</a>
          <a href="/logout" id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded ml-2 hidden">로그아웃</a>
          <span id="userName" class="block mt-2 text-gray-700 font-semibold hidden"></span>
        </div>
        <nav class="p-4 space-y-4">
          <a href="#" onclick="showPage('dashboard')" class="block hover:text-blue-600">대시보드</a>
          <a href="#" onclick="showPage('upload')" class="block hover:text-blue-600">영수증 업로드</a>
          <a href="#" onclick="showPage('transactions')" class="block hover:text-blue-600">거래 내역</a>
          <a href="#" onclick="showPage('statistics')" class="block hover:text-blue-600">통계</a>
        </nav>
      </aside>

      <!-- ✅ 메인 -->
      <main class="flex-1 p-6">
        <!-- ✅ 대시보드 -->
        <section id="dashboard" class="page">
          <header class="mb-6 text-2xl font-bold">대시보드</header>

          <!-- ✅ 통계 카드 -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="p-4 bg-white rounded-lg shadow">
              <h3 class="text-sm text-gray-500">총 지출</h3>
              <p id="totalSpent" class="text-xl font-bold">₩0</p>
            </div>
            <div class="p-4 bg-white rounded-lg shadow">
              <h3 class="text-sm text-gray-500">월 예산</h3>
              <p id="monthlyBudget" class="text-xl font-bold">₩0</p>
            </div>
            <div class="p-4 bg-white rounded-lg shadow">
              <h3 class="text-sm text-gray-500">거래 횟수</h3>
              <p id="transactionCount" class="text-xl font-bold">0건</p>
            </div>
            <div class="p-4 bg-white rounded-lg shadow">
              <h3 class="text-sm text-gray-500">남은 예산</h3>
              <p id="remainingBudget" class="text-xl font-bold">₩0</p>
            </div>
          </div>

          <!-- ✅ 월별 선택 필터 -->
          <div id="monthFilter" class="mb-4">
            <label for="monthSelector" class="block text-sm font-medium text-gray-700 mb-1">월별 내역 보기</label>
            <!-- select는 main.js에서 자동 생성됨 -->
          </div>

          <!-- ✅ 카테고리 원형 그래프 -->
          <div class="bg-white p-6 rounded-lg shadow flex justify-center mb-6" style="height: 400px;">
            <canvas id="expenseChart" class="w-80 h-80"></canvas>
          </div>

          <!-- ✅ 월 예산 입력 -->
          <div class="p-4 bg-white rounded-lg shadow mt-4">
            <h3 class="text-lg font-bold mb-2">월 예산 설정</h3>
            <input id="budgetInput" type="number" class="border p-2 rounded w-1/2" placeholder="예: 2000000" />
            <button onclick="saveBudget()" class="ml-2 bg-green-500 text-white px-4 py-2 rounded">저장</button>
            <p id="budgetStatus" class="mt-2 text-gray-600 text-sm"></p>
          </div>
        </section>

        <!-- ✅ 영수증 업로드 -->
        <section id="upload" class="page hidden">
          <header class="mb-6 text-2xl font-bold">영수증 업로드</header>
          <div class="bg-white p-6 rounded-lg shadow">
            <p class="mb-4">이미지를 선택 후 업로드하세요.</p>
            <input type="file" id="receiptUpload" class="border p-2 w-full" />
            <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded" onclick="uploadReceipt()">업로드</button>
            <div id="uploadResult" class="mt-4"></div>

            <!-- ✅ 단계별 교정 UI (현재 숨김) -->
            <div id="correctionBox" class="hidden mt-4 bg-white p-4 rounded shadow">
              <h3 class="text-lg font-bold mb-2">OCR 교정</h3>
              <p id="correction-step-label" class="mb-2 font-semibold"></p>
              <input type="text" id="correction-input" class="border p-2 w-full rounded" placeholder="" />
              <button id="save-correction-btn" class="mt-2 bg-green-500 text-white px-4 py-2 rounded">저장</button>
              <p id="correction-status" class="text-sm mt-2 text-gray-600"></p>
            </div>
          </div>
        </section>

        <!-- ✅ 거래 내역 -->
        <section id="transactions" class="page hidden">
            <header class="mb-6 text-2xl font-bold">거래 내역</header>
            <div class="bg-white p-6 rounded-lg shadow">
                <table class="w-full border">
                    <thead><tr class="bg-gray-100"><th class="border p-2">날짜</th><th class="border p-2">가맹점</th><th class="border p-2">금액</th><th class="border p-2">카테고리</th></tr></thead>
              <tbody id="tx-tbody"></tbody> <!-- ✅ id 추가 -->
            </table>
          </div>
        </section>

        <!-- ✅ 통계 -->
        <section id="statistics" class="page hidden">
          <header class="mb-6 text-2xl font-bold">통계</header>
          <div class="bg-white p-6 rounded-lg shadow" style="height: 400px;">
            <canvas id="statsChart"></canvas>
          </div>
        </section>

        <!-- ✅ 삭제 후 5초간 되돌리기 토스트 -->
        <div
          id="undo-toast"
          class="fixed left-1/2 -translate-x-1/2 bottom-6 hidden
                 bg-white border border-gray-200 shadow-lg rounded-lg
                 px-4 py-3 flex items-center gap-3"
        >
          <span class="toast-text text-sm text-gray-700">삭제되었습니다.</span>
          <button class="btn-undo bg-blue-600 text-white text-sm px-3 py-1 rounded">되돌리기</button>
        </div>
      </main>
    </div>

    <script src="main.js?v=20251025-1"></script>
  </body>
</html>


